<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logistics Booking</title>
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="/css/style_v2.css">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">

<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body onload="populateUserData()">
	<div class="header-bar"></div>
	<div class="navbar">
		<div class="navbar-left">
			<a href="#" onclick="showBookingForm()">Home</a>
			<div class="dropdown">
				<a href="#">Operations</a>
				<div class="dropdown-content">
					<a href="#">Booking</a> <a href="#">Dispatch</a> <a href="#">Receive</a>
					<a href="#">Delivery</a>
				</div>
			</div>
			<div class="dropdown">
				<a href="#">Reports</a>
				<div class="dropdown-content">
					<a href="#" onclick="showReportForm('booking')">Booking Report</a>
					<a href="#" onclick="showReportForm('dispatched')">Dispatch
						Report</a> <a href="#" onclick="showReportForm('received')">Receive
						Report</a> <a href="#" onclick="showReportForm('delivered')">Delivery
						Report</a>
				</div>
			</div>
			<!-- Inside the Manage dropdown -->
			<div class="dropdown">
				<a href="#">Manage</a>
				<div class="dropdown-content">
					<!-- <li><a id="createBranchLink" class="dropdown-item" href="#">Create
							Branch</a></li> -->
					<a href="#" onclick="showCreateBranchForm()">Branch Manage</a>
					<a  href="#" onclick="showCreateEmployeeForm()">Create Employee</a>
					
				</div>
			</div>
		</div>
		<div class="navbar-right">
			<div class="user-dropdown">
				<div class="user-icon">
					<i class="fas fa-user"></i>
				</div>
				<div class="user-dropdown-content">
					<div class="user-info" id="user-info-modal">
						<p>
							<strong>First Name:</strong> <span id="userFirstName"></span>
						</p>
						<p>
							<strong>Last Name:</strong> <span id="userLastName"></span>
						</p>

					</div>
					<div class="user-actions">
						<button onclick="showChangePasswordForm()">Change
							Password</button>
						<button onclick="logout()">Logout</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="changePasswordForm" class="change-password-form">
		<h3>Change Password</h3>
		<label for="currentPassword">Current Password:</label> <input
			type="password" id="currentPassword"> <label
			for="newPassword">New Password:</label> <input type="password"
			id="newPassword"> <label for="confirmPassword">Confirm
			New Password:</label> <input type="password" id="confirmPassword">
		<button class="btn btn-primary" onclick="submitChangePassword()">Submit</button>
		<button class="btn btn-secondary" onclick="hideChangePasswordForm()">Cancel</button>
		<div id="passwordMessage"
			style="margin-top: 10px; display: none; color: red;"></div>
	</div>
	<div id="bookingReportForm" class="report-form">
		<h3>Booking Report</h3>
		<input type="hidden" id="reportStatusHidden" /> <label for="fromDate">From
			Date:</label> <input type="date" id="fromDate"> <label for="toDate">To
			Date:</label> <input type="date" id="toDate">
		<button onclick="generateBookingReport()">Generate Report</button>
		<div id="reportMessage"
			style="margin-top: 10px; display: none; color: red;"></div>
		<div id="reportTableContainer"></div>
		<div id="reportActions" style="display: none;">
			<button onclick="downloadBookingReport()">Download PDF</button>
			<button onclick="downloadBookingReportExcel()">Download
				Excel</button>
			<button id="dispatchSelectedButton" onclick="dispatchSelected()">Dispatch
				Selected</button>
		</div>
	</div>
	<div class="container" id="bookingFormContainer"
		style="display: block;">
		<h2>Logistics Booking Form</h2>
		<form id="bookingForm">
			<label for="deliveryDestination">Delivery Destination:</label> <input
				type="text" id="deliveryDestination" list="destinationList"
				autocomplete="off">
			<datalist id="destinationList"></datalist>



		
			<h3>Consignor (From)</h3>
			<label for="consignorName">Name:</label> <input type="text"
				id="consignorName" required> <label for="consignorMobile">Mobile
				No:</label> <input type="text" id="consignorMobile" inputmode="numeric"
				pattern="^[0-9]{10}$" maxlength="10" required
				title="Please enter valid phone number"> <label
				for="consignorGST">GST No:</label> <input type="text"
				id="consignorGST"> <label for="consignorAddress">Address:</label>
			<input type="text" id="consignorAddress">
			<h3>Consignee (To)</h3>
			<label for="consigneeName">Name:</label> <input type="text"
				id="consigneeName" required> <label for="consigneeMobile">Mobile
				No:</label> <input type="text" id="consigneeMobile" inputmode="numeric"
				pattern="^[0-9]{10}$" maxlength="10" required> <label
				for="consigneeGST">GST No:</label> <input type="text"
				id="consigneeGST"> <label for="consigneeAddress">Address:</label>
			<input type="text" id="consigneeAddress">
			<h3>Article Details</h3>
			<table>
				<thead>
					<tr>
						<th>Article</th>
						<th>Art Quantity</th>
						<th>Art Type</th>
						<th>Said To Contains</th>
						<th>Art Amt</th>
						<th>Total</th>
						<th>Action</th>
					</tr>
				</thead>
				<tbody>
					<tr>

						<td><select id="article">
								<option value="Article">Article</option>
								<option value="Weight">Weight</option>
								<option value="Fix">Fix</option>
						</select></td>
						<td><input type="number" id="artQuantity" value="0"></td>
						<td><select id="artType">
								<option value="Auto Parts">Auto Parts</option>
								<option value="Electronics">Electronics</option>
								<option value="Garments">Garments</option>
						</select></td>
						<td><select id="saidToContain">
								<option value="Spare Parts">Spare Parts</option>
								<option value="Components">Components</option>
								<option value="Accessories">Accessories</option>
						</select></td>
						<td><input type="number" id="artAmount" value="0"></td>
						<td><span id="totalAmount">0</span></td>
						<td><button type="button" onclick="addArticle()">Add</button></td>
					</tr>

				</tbody>

			</table>

			<input type="text" id="INVOICE NO." placeholder="INVOICE NO.">
			<input type="text" id=" " placeholder=" 0"> <input
				type="text" id="E-Waybill" placeholder="E-Waybill">

			<h3>Charges</h3>
			<div class="charges">
				<label for="freight">Freight:</label> <input type="number"
					id="freight" value="0" oninput="calculateCharges()" readonly>
				<label for="sgst">SGST (2.5%):</label> <input type="number"
					id="sgst" value="0" readonly> <label for="cgst">CGST
					(2.25%):</label> <input type="number" id="cgst" value="0" readonly>
				<label for="igst">IGST (5%):</label> <input type="number" id="igst"
					value="0" readonly> <label for="grandTotal">Grand
					Total:</label> <input type="number" id="grandTotal" readonly>
			</div>
			<button type="submit">Booking</button>
		</form>
	</div>



	<div id="CreateBranchContainer"
		style="display: flex; justify-content: center; align-items: center; height: 50vh; padding: 10px; overflow: visible;">
		<!-- Toast Container -->
		<div class="toast-container position-fixed top-0 end-0 p-3">
			<div id="liveToast" class="toast bg-success text-white" role="alert"
				aria-live="assertive" aria-atomic="true">
				<div class="toast-header">
					<strong class="me-auto">Notification</strong>
					<button type="button" class="btn-close" data-bs-dismiss="toast"
						aria-label="Close"></button>
				</div>
				<div class="toast-body" id="toastMessage"></div>
			</div>
		</div>
		<div class="container" style="max-width: 1000px;">
			<h2>Branch Manage Form</h2>
			<form id="branchForm" class="row g-3 bg-white p-4 rounded shadow"
				style="height: 100%;">
				<div class="row">
					<div class="col-6">
						<label class="form-label">Branch Name *</label> <input type="text"
							class="form-control" id="branchname" required>
					</div>
					<div class="col-6">
						<label class="form-label">Branch Code *</label> <input type="text"
							class="form-control" id="branchcode" required>
						<div id="branchCodeError" class="error text-danger"></div>
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						<label class="form-label">Branch opperations *</label> <select
							class="form-select" id="opperations" required>
							<option value="">-- Select --</option>
							<option>Both</option>
							<option>Delivery</option>
							<option>Booking</option>
						</select>
					</div>
					<div class="col-6">
						<label class="form-label">PAN No</label> <input type="text"
							class="form-control" id="pan">
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						<label class="form-label">Phone Number</label> <input type="text"
							class="form-control" id="phone">
					</div>
					<div class="col-6">
						<label class="form-label">GSTIN</label> <input type="text"
							class="form-control" id="gstin">
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						<label class="form-label">Email Address</label> <input
							type="email" class="form-control" id="email">
					</div>
					<div class="col-6">
						<label class="form-label">Contact Person *</label> <input
							type="text" class="form-control" id="contactperson" required>
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						<label class="form-label">FlatOrApartmentNumber *</label> <input
							type="text" class="form-control" id="flatorapartmentNumber"
							required>
					</div>
					<div class="col-6">
						<label class="form-label">Area Or Streetline *</label>
						<textarea class="form-control" id="AddressStreet" required></textarea>
					</div>

				</div>



				<div class="row">
					<div class="col-6">
						<label class="form-label">LandMark</label> <input type="text"
							class="form-control" id="landmark" required>
					</div>
					<div class="col-6">
						<label class="form-label">Postalcode *</label> <input type="text"
							class="form-control" id="postalCode" required pattern="\d{6}">
						<div id="postalCodeError" class="error text-danger"></div>
					</div>

				</div>

				<div class="row">
					<div class="col-6">
						<label class="form-label">State *</label> <input type="text"
							class="form-control" id="state" required>

					</div>
					<div class="col-6">
						<div style="position: relative;">
							<label class="form-label">City *</label> <input type="text"
								class="form-control" id="city" required>
							<div id="cityDropdown" class="city-dropdown"></div>
						</div>

					</div>
				</div>

				<!-- <div class="row">
					<div class="col-6">
						<label class="form-label">Region *</label> <select
							class="form-select" id="region" required>
							<option value="">-- Select --</option>
							<option>South</option>
						</select>
					</div>
					<div class="col-6">
						<label class="form-label d-block">Agent Branch?</label>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="agent" checked>
							<label class="form-check-label">No</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="agent">
							<label class="form-check-label">Yes</label>
						</div>
					</div>
				</div> -->

				<div class="row">
					<div class="col-12">
						<label class="form-label">Branch Type *</label> <select
							class="form-select" id="branchType" required>
							<option value="">-- Select --</option>
							<option>General</option>
							<option>Head-office</option>
						</select>
					</div>
				</div>

				<div class="btn-group mt-2 gap-2">
					<button type="submit" id="submitBtn" class="btn btn-primary"
						disabled>Add</button>

					<button type="button" class="btn btn-success">Edit</button>
					<button type="button" class="btn btn-danger">Delete</button>
					<button type="button" class="btn btn-warning text-white"
						id="resetBtn">Reset</button>
					<button type="button" class="btn btn-secondary">Deactivate</button>


				</div>
				
					
				
			</form>
		<div id="createEmployeeFormContainer" style="display: none;" class="container mt-4">
    <h3 class="text-center mb-4">Create Employee</h3>
    <div id="formMessage"></div>
    <form id="createEmployeeForm" autocomplete="off">
        <div class="row mb-3">
            <div class="col-3">
                <select class="form-select" id="branchSelect">
                    <option selected>---- Select Branch ----</option>
                </select>
            </div>
            <div class="col-1">
                <button type="reset" class="btn btn-secondary w-100">Reset</button>
            </div>
        </div>
        <div class="card">
            <div class="card-header"><h5>User Information</h5></div>
            <div class="card-body">
                <div class="row mb-2">
                    <div class="col-md-3"><label class="form-label">First Name</label><input type="text" id="firstName" class="form-control" required oninput="this.value = this.value.toUpperCase()"></div>
                    <div class="col-md-3"><label class="form-label">Last Name</label><input type="text" id="lastName" class="form-control" required oninput="this.value = this.value.toUpperCase()"></div>
                    <div class="col-md-3"><label class="form-label">Username</label><input type="text" id="userName" class="form-control" required><div id="usernameError" class="text-danger small"></div></div>
                    <div class="col-md-3"><label class="form-label">Password</label><input type="password" id="password" class="form-control" required></div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-3"><label class="form-label">Confirm Password</label><input type="password" id="confirmPassword" class="form-control" required><div id="confirmPasswordError" class="text-danger small"></div></div>
                    <div class="col-md-3"><label class="form-label">Phone</label><input type="text" id="phone" class="form-control" maxlength="10" pattern="\d{10}" required></div>
                    <div class="col-md-3"><label class="form-label">Email</label><input type="email" id="email" class="form-control"></div>
                    <div class="col-md-3"><label class="form-label">Role</label>
                        <select class="form-select" id="role" required>
                            <option value="Employee">Employee</option>
                            <option value="Admin">Admin</option>
                            <option value="SuperAdmin">SuperAdmin</option>
                        </select>
                    </div>
                </div>
                <div class="text-end mt-3">
                    <button type="button" class="btn btn-success" id="submitButton">Create Employee</button>
                </div>
            </div>
        </div>
    </form>
</div>
			
		</div>
	</div>
	</div>




	<div id="overlay" class="overlay"></div>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

	<script>   
	document.getElementById("consignorMobile").addEventListener("input", function (e){
  			this.value = this.value.replace(/[^0-9]/g, '');
  		});
		</script>

	<script>   
			document.getElementById("consigneeMobile").addEventListener("input", function (e){
		  			this.value = this.value.replace(/[^0-9]/g, '');
		  		});
	</script>

	<script>
			  document.getElementById('deliveryDestination').addEventListener('click',(e)=>{
			    e.stopPropagation();
			    document.getElementById('destinationList').style.display = 'block';
			  });

			
	</script>

	<script src="/js/bookings.js"></script>
	
	
	<script>
	    let idleTime = 0;
	    const maxIdleMinutes = 2;
		
		document.onmousemove = document.onkeypress = document.onclick = () => idleTime = 0;

	   <!-- function resetTimer() {
	        idleTime = 0;
	    }

	    window.onload = resetTimer;
	    document.onmousemove = resetTimer;
	    document.onkeypress = resetTimer;
	    document.onclick = resetTimer;
	    document.onscroll = resetTimer;-->

	    setInterval(() => {
	        idleTime++;
	        if (idleTime >= maxIdleMinutes) {
	            window.location.href = '/login?session=expired'; // change as needed
	        }
	    }, 60000); // check every 1 minute
	</script>
	
	@using Microsoft.AspNetCore.Http;
	@inject IHttpContextAccessor HttpContextAccessor

	<div id="session">
	</div>

	<!--<script>
	    $(document).ready(function () {
	        var session = '@HttpContextAccessor.HttpContext.Session.GetString("UserName")';
	        if (session == "") {
	            SessionLogOut();
	        }
	    });
	    function SessionLogOut() {
	        $("div#session").append("<div id=\"TimeOut\" class=\"text-center\">Your session has expired, please<a href=\"/Home/Index\" class=\"btn signout\" style=\"padding: 1px 5px 1px 5px;\">click here to login</a>again</div>");

	    }
		
	</script>-->
	
	
	<!--services.AddSession(options =>
			{
			      options.IdleTimeout = TimeSpan.FromSeconds(2);
			});-->
	
			
			
</body>
</html>