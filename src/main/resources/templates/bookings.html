<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard-1Uniq</title>
<!-- Select2 CSS -->
<link rel="icon" type="image/png" sizes="512x512" href="/favicon.png">
<link
	href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
	rel="stylesheet" />
<!-- jQuery (required by Select2) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Select2 JS -->
<script
	src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="/css/style_v2.css">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="icon" href="data:,">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- Small layout patch CSS (kept light — your style_v2.css remains primary) -->
<style>
:root{ --bg:#f3f6f9; --sidebar:#12233a; --primary:#0b5ed7; --accent:#0b79d7; }
body{font-family:'Poppins',sans-serif;background:var(--bg);margin:0}
.app-shell{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
.sidebar{background:var(--sidebar);color:#fff;padding:18px;min-height:100vh;box-sizing:border-box}
.brand{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.brand img{height:46px;border-radius:6px}
.nav-link{color:#cfe8ff;text-decoration:none;display:block;padding:10px;border-radius:8px}
.nav-link:hover{background:rgba(255,255,255,0.03);color:#fff}
.sub-list a{display:block;padding:6px 12px;color:#bfe9ff;text-decoration:none;border-radius:6px;margin:2px 0}
.sub-list a:hover{background:rgba(255,255,255,0.02)}
.lr-badge{background:linear-gradient(90deg,var(--primary),var(--accent));padding:12px;border-radius:10px;text-align:center;margin-top:18px}
.content{padding:14px 28px}
.topbar{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:10px; padding:10px 6px}
.lr-top{padding:8px 12px;border-radius:8px;background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;font-weight:800}
.btn-statement{background:#fff;border:1px solid #e6f0fb;color:var(--primary);padding:8px 12px;border-radius:8px}
.booking-card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(16,24,40,0.06)}
.charges-panel{background:#fff;border:1px solid #e6f0ff;border-radius:8px;padding:16px}
@media (max-width:1100px){ .app-shell{grid-template-columns:1fr} .sidebar{display:none} }
</style>

</head>
<body onload="populateUserData()">
	<script src="/js/auth.js"></script>
	<script>
		if (!protectPage()) {
			// Stop further loading
			throw new Error("Blocked: Not logged in");
		}
	</script>

<!-- ========== START: New layout (sidebar + topbar) ========== -->
<div class="app-shell">

  <!-- Sidebar (global search on top) -->
  <aside class="sidebar">
    <div class="brand">
      <img  id="companyLogo" src="" alt="logo">
      <div>
        <div style="font-weight:800" id="branchresult"></div>
      </div>
    </div>

    <nav>
      <a href="#" class="nav-link" onclick="showBookingForm()"><i class="fa fa-home me-2"></i> Home</a>

      <div style="margin-top:6px;">
        <div class="nav-link" style="padding-bottom:6px"><i class="fa fa-cogs me-2"></i> Operations</div>
        <div class="sub-list">
          <a href="#" onclick="showBookingForm()">Booking</a>
          <a href="#dispatchops" onclick="showOperationSearchForm('DISPATCHED')">Dispatch</a>
          <a href="#recieveops" onclick="comingSoon()">Receive</a>
          <a href="#deliveryops" onclick="comingSoon()">Delivery</a>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div class="nav-link" style="padding-bottom:6px"><i class="fa fa-chart-line me-2"></i> Reports</div>
        <div class="sub-list">
          <a href="#booking" onclick="showReportForm('booking')">Booking Report</a>
          <a href="#dispatch" onclick="showReportForm('dispatched')">Dispatch Report</a>
          <a href="#receive" onclick="comingSoon()">Receive Report</a>
          <a href="#delivered" onclick="comingSoon()">Delivery Report</a>
        </div>
      </div>

      <div style="margin-top:12px;">
        <a href="javascript:void(0)" class="nav-link" onclick="checkManageAccess('branch')"><i class="fa fa-building me-2"></i> Branches</a>
        <a href="javascript:void(0)" class="nav-link" onclick="checkManageAccess('employee')"><i class="fa fa-user me-2"></i> Employees</a>
        <a href="javascript:void(0)" class="nav-link" onclick="checkManageAccess('vehicle')"><i class="fa fa-truck-moving me-2"></i> Vehicles</a>
      </div>
      
      <div class="nav-link" style="display:flex;align-items:center;gap:6px;cursor:pointer;" onclick="showGlobalSearchForm()">
    <i class="fa fa-search"></i> Global Search
  </div>
  
   <!-- Statements dropdown in sidebar -->
  <div style="margin-top:12px;">
    <div class="nav-link" style="padding-bottom:6px;display:flex;align-items:center;gap:6px;cursor:pointer;">
      <i class="fa fa-file-invoice-dollar"></i> Statements
    </div>
    <div class="sub-list">
      <a href="#statements" onclick="showStatementsForm()">View Statements</a>
    </div>
  </div>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="content">

    <!-- TOP BAR (LR No + LR search, Statements, shortcuts, user) -->
<div class="topbar">
  <!-- LEFT SIDE: LR Display + Search -->
  <div style="display:flex;align-items:center;gap:12px">
    <!-- LR No Display -->
    <div id="nextLrDisplay" class="badge"
      style="background-color: red; color: white; font-weight: bold; margin-right: 15px;">
      LR No: --
    </div>

    <!-- LR Search -->
    <div class="navbar-lr-search" style="margin-right: 10px;">
      <input type="text" id="lrSearchInput"
        class="form-control d-inline-block" placeholder="Search LR"
        autocomplete="off" style="width: 180px; display: inline-block;" />
      <button id="lrSearchBtn" class="btn btn-primary"
        style="margin-left: -5px;">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </div>

  <!-- RIGHT SIDE: Statements + Shortcuts + User -->
  <div style="display:flex;align-items:center;gap:12px">
    <!-- Shortcut Keys -->
    <div class="shortcut-dashboard-box">
      <span class="badge bg-primary" onclick="setPaymentMode('PAID')">F7</span>
      : PAID 
      <span class="badge bg-primary" onclick="setPaymentMode('TO PAY')">F8</span>
      : TO PAY 
      <span class="badge bg-primary" onclick="setPaymentMode('TBB')">F9</span>
      : TBB
    </div>

    <!-- User Dropdown -->
    <div class="user-dropdown">
      <div class="user-icon">
        <i class="fas fa-user"></i>
      </div>
      <div class="user-dropdown-content">
        <div class="user-info" id="user-info-modal">
          <p><strong>First Name:</strong> <span id="userFirstName"></span></p>
          <p><strong>Last Name:</strong> <span id="userLastName"></span></p>
        </div>
        <div class="user-actions">
          <button onclick="showChangePasswordForm()">Change Password</button>
          <button onclick="logout()">Logout</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- LR Search Results -->
<div id="lrSearchResultContainer" class="container" style="display: none;"></div>

<!-- Change Password Form -->
<div id="changePasswordForm" class="change-password-form" style="display:none;">
  <h3>Change Password</h3>
  <label for="currentPassword">Current Password:</label>
  <input type="password" id="currentPassword">
  <label for="newPassword">New Password:</label>
  <input type="password" id="newPassword">
  <label for="confirmPassword">Confirm New Password:</label>
  <input type="password" id="confirmPassword">

  <button class="btn btn-primary" onclick="changePassword()">Submit</button>
  <button class="btn btn-secondary" onclick="hideChangePasswordForm()">Cancel</button>

  <div id="passwordMessage" style="margin-top: 10px; display: none; color: red;"></div>
</div>



<!-- ========== END: New layout header ========== -->

<!-- #1booking form start (rest of your original HTML preserved) -->
	<div class="container" id="bookingFormContainer"
		style="display: block;">
		<div id="selectedPaymentModeDisplay" class="h2"
			style="margin-bottom: 10px; display: none;">
			<span class="badge bg-primary" id="selectedModeLabel"></span>
		</div>

		<form id="bookingForm">
			<input type="hidden" id="paymentMode" name="paymentMode">

			<div class="row">
				<!-- Left Column: All Form Fields -->
				<div class="col-md-8">
					<!-- Delivery Destination -->
					<h3>Delivery Destination: *</h3>
					<div class="mb-3">
						<label for="deliveryDestination" class="form-label"> </label> <select
							id="deliveryDestination" class="form-select select2">
							<option value=""></option>
						</select>
					</div>

					<!-- Consignor Row -->
					<h3>Consignor (From)</h3>
					<div class="row mb-3">
						<div class="col-md-3">
							<label class="form-label">Consignor Name*</label> <input
								type="text" id="consignorName" class="form-control"
								name="consignorName">
						</div>
						<div class="col-md-3">
							<label class="form-label">Mobile*</label> <input type="text"
								id="consignorMobile" class="form-control" name="consignorMobile"
								maxlength="10" pattern="[0-9]{10}" inputmode="numeric">
						</div>
						<div class="col-md-2">
							<label class="form-label">GST</label> <input type="text"
								id="consignorGST" class="form-control" name="consignorGST">
						</div>
						<div class="col-md-4">
							<label class="form-label">Address*</label> <input type="text"
								id="consignorAddress" class="form-control"
								name="consignorAddress">
						</div>
					</div>

					<!-- Consignee Row -->
					<h3>Consignee (To)</h3>
					<div class="row mb-3">
						<div class="col-md-3">
							<label class="form-label">Consignee Name*</label> <input
								type="text" id="consigneeName" class="form-control"
								name="consigneeName">
						</div>
						<div class="col-md-3">
							<label class="form-label">Mobile*</label> <input type="text"
								id="consigneeMobile" class="form-control" name="consigneeMobile"
								maxlength="10" pattern="[0-9]{10}" inputmode="numeric">
						</div>
						<div class="col-md-2">
							<label class="form-label">GST</label> <input type="text"
								id="consigneeGST" class="form-control" name="consigneeGST">
						</div>
						<div class="col-md-4">
							<label class="form-label">Address*</label> <input type="text"
								id="consigneeAddress" class="form-control"
								name="consigneeAddress">
						</div>
					</div>

					<!-- Article Table -->
					<h3>Article Details</h3>
					<table class="table table-bordered" id="articlesTable">
						<thead>
							<tr>
								<th>Article</th>
								<th>Art Quantity</th>
								<th>Art Type</th>
								<th>Said To Contains</th>
								<th>Art Amt</th>
								<th>Total</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody id="editArticleTableBody">
							<tr>
								<td><select id="article" class="form-select">
										<option value="Article">Article</option>
										<option value="Weight">Weight</option>
										<option value="Fix">Fix</option>
								</select></td>
								<td><input type="number" id="artQuantity" value="0"
									class="form-control"></td>
								<td><select id="artType" class="form-select">
										<option value="Auto Parts">Auto Parts</option>
										<option value="Electronics">Electronics</option>
										<option value="Garments">Garments</option>
								</select></td>
								<td><select id="saidToContain" style="width: 250px;">
										<option></option>
										<!-- placeholder -->
								</select></td>
								<td><input type="number" id="artAmount" value="0"
									class="form-control"></td>
								<td><span id="totalAmount">0</span></td>
								<td><button type="button" class="btn btn-sm btn-success"
										onclick="addArticlebooking()">Add</button></td>
							</tr>
						</tbody>
					</table>

					<!-- Invoice / E-Waybill Row -->
					<div class="row g-2 mb-3">
						<div class="col-md-4">
							<input type="text" id="invoiceNo"
								class="form-control form-control-sm" placeholder="INVOICE NO.">
						</div>
						<div class="col-md-2">
							<input type="text" id="Invoicevalue"
								class="form-control form-control-sm" placeholder="0"
								inputmode="numeric" pattern="^\d+(\.\d{1,2})?$">
						</div>
						<div class="col-md-6">
							<input type="text" id="ewayBill"
								class="form-control form-control-sm" placeholder="E-Waybill"
								inputmode="numeric" maxlength="12" pattern="^\d{12}$">
						</div>
					</div>
					<!-- Paid Via dropdown (smaller height) -->
					<div class="mb-3" id="paidViaContainer"
						style="display: none; max-width: 200px;">
						<label for="paidVia" class="form-label">Paid Via*</label> <select
							id="paidVia" name="paidVia" class="form-select form-select-sm">
							<option value="CASH">Cash</option>
							<option value="ONLINE">Online</option>
						</select>
					</div>

					<button type="submit" class="btn btn-primary">Booking</button>
				</div>

				<!-- Right Column: Charges Panel -->
				<div class="col-md-4">
					<div id="chargesPanel" class="charges-panel">
						<h6 class="text-center mb-2">Charges</h6>
						<div class="mb-2">
							<label for="freight">Freight:</label> <input type="number"
								id="freight" class="form-control" readonly value="0">
						</div>
						<div class="mb-2">
							<label for="loadingCharge">Loading:</label> <input type="number"
								id="loadingCharge" class="form-control" value="0" step="0.01"
								min="0">
						</div>
						<div class="mb-2">
							<label for="lrCharge">LR Charge:</label> <input type="number"
								id="lrCharge" class="form-control" value="0" step="0.01" min="0">
						</div>
						<div class="mb-2">
							<label for="sgst">SGST (2.5%):</label> <input type="number"
								id="sgst" class="form-control" readonly value="0">
						</div>
						<div class="mb-2">
							<label for="cgst">CGST (2.5%):</label> <input type="number"
								id="cgst" class="form-control" readonly value="0">
						</div>
						<div class="mb-2">
							<label for="igst">IGST (5%):</label> <input type="number"
								id="igst" class="form-control" readonly value="0">
						</div>
						<div class="mb-2">
							<label for="grandTotal">Grand Total:</label> <input type="number"
								id="grandTotal" class="form-control fw-bold" readonly value="0">
						</div>
					</div>
				</div>
			</div>
		</form>
	</div>

	<!-- #1booking form end -->

	<!-- rest of your original content (reports, modals, forms) kept as-is -->
	<div id="bookingReportForm" class="report-form"
		style="padding-bottom: 100px; overflow-y: auto; max-height: calc(100vh - 120px);">
		<h3>Booking Report</h3>
		<input type="hidden" id="reportStatusHidden" /> <label for="fromDate">From
			Date:</label> <input type="date" id="fromDate"> <label for="toDate">To
			Date:</label> <input type="date" id="toDate">
		<button onclick="generateBookingReport()">Generate Report</button>

		<!-- Error message -->
		<div id="reportMessage"
			style="margin-top: 10px; display: none; color: red;"></div>

		<!-- Report table will be injected here -->
		<div id="reportTableContainer" style="overflow-x: auto;"></div>

		<!-- Pagination controls -->
		<div id="paginationControls" class="text-center mt-3"
			style="display: none;">
			<button class="btn btn-secondary me-2" onclick="goToPreviousPage()"
				id="prevPageButton">Prev</button>
			<span id="pageNumberDisplay" style="font-weight: bold;">Page 1
				of 1</span>
			<button class="btn btn-primary ms-2" onclick="loadNextPage()"
				id="nextPageButton">Next</button>
		</div>

		<!-- Export & Dispatch Buttons -->
		<div id="reportActions" style="display: none;" class="mt-3">
			<button onclick="downloadBookingReport()">Download PDF</button>
			<button onclick="downloadBookingReportExcel()">Download
				Excel</button>
		</div>

		<!-- Booking summary will appear here -->
		<div id="bookingSummaryContainer" class="mt-4"></div>
	</div>

	<!-- GLOBAL SEARCH FORM SECTION (kept as before) -->
	<div id="globalSearchFormContainer" class="report-form"
		style="display: block; padding-bottom: 100px; max-height: calc(100vh - 120px); border: 1px solid #ccc;">

		<h3>Global Search Report</h3>

		<div class="row g-3 align-items-center">
			<div class="col-md-3">
				<label for="gFromDate" class="form-label">From Date</label> <input
					type="date" id="gFromDate" class="form-control">
			</div>
			<div class="col-md-3">
				<label for="gToDate" class="form-label">To Date</label> <input
					type="date" id="gToDate" class="form-control">
			</div>
		</div>

		<div class="row g-3 align-items-center mt-1">
			<div class="col-md-3">
				<label for="gRegion" class="form-label">Region</label> <select
					id="gRegion" class="form-select">
					<option value="">-- Select Region --</option>
				</select>
			</div>
			<div class="col-md-3">
				<label for="gSubregion" class="form-label">Sub-Region</label> <select
					id="gSubregion" class="form-select">
					<option value="">-- Select Sub-region --</option>
				</select>
			</div>
			<div class="col-md-3">
				<label for="gBranch" class="form-label">Branch</label> <select
					id="gBranch" class="form-select">
					<option value="">-- Select Branch --</option>
				</select>
			</div>
			<div class="col-md-3 d-flex align-items-end gap-2">
				<button type="button" class="btn btn-primary"
					onclick="generateGlobalBookingReport()">Find</button>
				<button type="button" class="btn btn-secondary"
					onclick="resetGlobalSearch()">Reset</button>
			</div>
		</div>

		<!-- ✅ Scrollable Booking Table Container Only -->
		<div id="globalSearchTableWrapper" class="mt-4"
			style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
			<div id="globalSearchTableContainer"></div>
		</div>

		<div id="globalLoadingIndicator" class="text-center mt-2"
			style="display: none;">Loading more records...</div>
		<div id="globalBookingSummaryContainer" class="mt-4"></div>
	</div>

	<!-- remainder of your HTML (branch form, modals, etc.) preserved exactly -->
	<div id="CreateBranchContainer"
		style="display: flex; justify-content: center; align-items: center; height: 50vh; padding: 10px; overflow: visible;">
		<!-- Toast Container -->
		<div class="toast-container position-fixed top-0 end-0 p-3">
			<div id="liveToast" class="toast bg-success text-white" role="alert"
				aria-live="assertive" aria-atomic="true">
				<div class="toast-header">
					<strong class="me-auto">Notification</strong>
					<button type="button" class="btn-close" data-bs-dismiss="toast"
						aria-label="Close"></button>
				</div>
				<div class="toast-body" id="toastMessage"></div>
			</div>
		</div>
		<div class="container" style="max-width: 1000px;">
			<h2>Branch Manage Form</h2>
			<form id="branchForm" class="row g-3 bg-white p-4 rounded shadow"
				style="height: 100%;">

				<!-- Row 0: Select Branch to Edit -->
				<div class="row" id="branchSelectRow" style="display: none;">
					<div class="col-12">
						<label class="form-label">Select Branch *</label> <select
							class="form-select" id="branchSelectDropdown">
							<option value="">-- Select Branch --</option>
						</select>
					</div>
				</div>

				<!-- Row 1: State, City -->
				<div class="row">
					<div class="col-6">
						<label class="form-label">State *</label> <input
							class="form-control" list="stateList" id="state" required
							placeholder="Type to search...">
						<datalist id="stateList"></datalist>
					</div>

					<div class="col-6">
						<label class="form-label">City *</label> <input type="text"
							class="form-control" id="city" required>
					</div>
				</div>

				<!-- Row 2: Branch Name, Branch Code -->
				<div class="row">
					<div class="col-6">
						<label class="form-label">Branch Name *</label> <input type="text"
							class="form-control" id="branchname" required>
					</div>
					<div class="col-6">
						<label class="form-label">Branch Code *</label> <input type="text"
							class="form-control" id="branchcode" required>
						<div id="branchCodeError" class="error text-danger"></div>
					</div>
				</div>

				<!-- Row 3: Branch Type -->
				<div class="row">
					<div class="col-12">
						<label class="form-label">Branch Type *</label> <select
							class="form-select" id="branchType" required>
							<option value="">-- Select --</option>
							<option>ALL</option>
							<option>BOOKING</option>
							<option>DELIVERY</option>
						</select>
					</div>
				</div>

				<!-- Row 5: Landmark -->
				<div class="row">
					<div class="col-6">
						<label class="form-label">Address*</label>
						<textarea class="form-control" id="AddressStreet" required></textarea>
					</div>

				</div>

				<!-- Row 6: Phone 1, Phone 2 -->
				<div class="row">
					<div class="col-6">
						<label class="form-label">Phone Number 1*</label> <input
							type="text" class="form-control" id="phone" inputmode="numeric"
							pattern="^[0-9]{10}$" maxlength="10" required>
					</div>
					<div class="col-6">
						<label class="form-label">Phone Number 2</label> <input
							type="text" class="form-control" id="phone2" inputmode="numeric"
							pattern="^[0-9]{10}$" maxlength="10">
					</div>
					<div class="col-6">
						<label class="form-label">Email Address</label> <input
							type="email" class="form-control" id="email">
					</div>
				</div>

				<!-- Row 7: GSTIN -->
				<div class="row">
					<div class="col-6">
						<label class="form-label">GSTIN</label> <input type="text"
							class="form-control" id="gstin">
					</div>
					<div class="col-6">
						<label class="form-label">Contact Person *</label> <input
							type="text" class="form-control" id="contactperson" required>
					</div>
					<div class="col-6">
						<label class="form-label">Postal Code </label> <input type="text"
							class="form-control" id="postalCode" required pattern="\d{6}">
						<div id="postalCodeError" class="error text-danger"></div>
					</div>
				</div>


				<!-- Buttons -->
				<div class="btn-group mt-2 gap-2">
					<button type="submit" id="submitBtn" class="btn btn-primary">Add</button>
					<button type="button" id="editBtn" class="btn btn-success"
						onclick="loadBranchesForEdit()">Edit</button>
					<button type="button" id="updateBtn"
						class="btn btn-warning text-white" style="display: none;"
						onclick="updateBranch()">Update</button>
					<!-- <button type="button" class="btn btn-danger">Deactivate</button> -->
					<button type="button" class="btn btn-secondary"
						onclick="resetBranchForm()">Reset</button>
				</div>


			</form>
		</div>

	</div>

	<!-- the rest of your file (employee form, operation search, modals, statements, etc.) kept unchanged -->
	<div id="overlay" class="overlay"></div>
	<div id="createEmployeeFormContainer" style="display: none;"
		class="container mt-4">
		<h3 class="text-center mb-4">Create Employee</h3>
		<div id="formMessage"></div>
		<form id="createEmployeeForm" autocomplete="off">
			<div class="row mb-3">
				<div class="col-3">
					<select class="form-select" id="branchSelect">
						<option selected>---- Select Branch ----</option>
					</select>
				</div>
				<div class="col-1">
					<button type="reset" class="btn btn-secondary w-100">Reset</button>
				</div>
			</div>
			<div class="card">
				<div class="card-header">
					<h5>User Information</h5>
				</div>
				<div class="card-body">
					<div class="row mb-2">
						<div class="col-md-3">
							<label class="form-label">First Name</label><input type="text"
								id="employeefirstName" class="form-control" required
								oninput="this.value = this.value.toUpperCase()">
						</div>
						<div class="col-md-3">
							<label class="form-label">Last Name</label><input type="text"
								id="employeelastName" class="form-control" required
								oninput="this.value = this.value.toUpperCase()">
						</div>
						<div class="col-md-3">
							<label class="form-label">Username</label><input type="text"
								id="employeeuserName" class="form-control" required>
							<div id="usernameError" class="text-danger small"></div>
						</div>
						<div class="col-md-3">
							<label class="form-label">Password</label><input type="password"
								id="employeepassword" class="form-control" required>
						</div>
					</div>
					<div class="row mb-2">
						<div class="col-md-3">
							<label class="form-label">Confirm Password</label><input
								type="password" id="employeeconfirmPassword"
								class="form-control" required>
							<div id="employeeconfirmPasswordError" class="text-danger small"></div>
						</div>
						<div class="col-md-3">
							<label class="form-label">Phone</label> <input type="text"
								id="employeephone" class="form-control" maxlength="10" required
								oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,10);">
						</div>
						<div class="col-md-3">
							<label class="form-label">Email</label><input type="email"
								id="employeeemail" class="form-control">
						</div>
						<div class="col-md-3">
							<label class="form-label">Role</label> <select
								class="form-select" id="employeerole" required>
								<option value="Employee">Employee</option>
								<option value="Admin">Admin</option>
								<option value="SuperAdmin">SuperAdmin</option>
							</select>
						</div>
					</div>
					<div class="text-end mt-3">
						<button type="button" class="btn btn-success" id="submitButton">Create
							Employee</button>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div id="operationSearchForm"
		style="max-height: calc(100vh - 130px); overflow-y: auto; padding: 1rem;">
		<h3 id="operationFormTitle">Operation Search</h3>

		<div class="row g-3">

			<div class="col-md-3">
				<label for="opRegion" class="form-label">Region*</label> <select
					id="opRegion" class="form-select"></select>
			</div>
			<div class="col-md-3">
				<label for="opSubregion" class="form-label">Sub-Region*</label> <select
					id="opSubregion" class="form-select"></select>
			</div>
			<div class="col-md-3">
				<label for="opBranch" class="form-label">Branch*</label> <select
					id="opBranch" class="form-select"></select>
			</div>

			<div class="col-md-12 mt-2">
				<button class="btn btn-primary" onclick="submitOperationReport()">Find
					Bookings</button>
				<button class="btn btn-secondary" onclick="resetOperationFilters()">Reset</button>
			</div>
		</div>

		<hr>
		<!-- Scrollable Table Container -->
		<div id="operationResultContainer"
			style="max-height: 400px; overflow: auto; border: 1px solid #ccc; background-color: #fff;">
			<!-- Table will be injected here -->
		</div>

		<!-- Dispatch Button (outside scroll) -->
		<button id="dispatchActionBar" class="btn btn-success mt-2"
			onclick="showAssociateVehicleModal()" style="display: none;">
			🚚 Dispatch Selected</button>

		<!-- Booking Summary (outside scroll) -->
		<div id="bookingopsSummaryContainer"
			style="display: none; margin-top: 20px; background-color: #f9f9f9; padding: 10px; border-radius: 5px;">
			<!-- Summary content injected -->
		</div>


	</div>

	<!-- Vehicle Modal -->
	<div class="modal fade" id="associateVehicleModal" tabindex="-1"
		aria-labelledby="vehicleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<!-- ⬅️ changed to modal-lg for 2-column layout -->
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Vehicle & Driver Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>

				<div class="modal-body">
					<form id="associateVehicleForm">
						<div class="row g-3">
							<div class="col-md-6">
								<label for="truckNumber" class="form-label">Truck
									Number*/label> <select id="truckNumber" class="form-select">
										<option value="">-- Select Truck --</option>
								</select> <datalist id="truckNumberOptions"></datalist>
							</div>

							<div class="col-md-6">
								<label for="vehicleName" class="form-label">Vehicle
									Name*</label> <input type="text" id="vehicleName" class="form-control"
									placeholder="Vehicle Name">
							</div>

							<div class="col-md-6">
								<label for="driverName" class="form-label">Driver Name*</label>
								<input type="text" id="driverName" class="form-control"
									placeholder="Driver Name">
							</div>

							<div class="col-md-6">
								<label for="driverPhone" class="form-label">Driver
									Phone*</label> <input type="text" id="driverPhone" class="form-control"
									placeholder="Driver Phone">
							</div>

							<div class="col-md-12">
								<label for="destinationBranchInput" class="form-label">Destination
									Branch*</label> <input list="destinationBranchList"
									id="destinationBranchInput" class="form-control"
									placeholder="Search Branch Name..." autocomplete="off" />
								<datalist id="destinationBranchList"></datalist>
							</div>

						</div>
					</form>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary"
						onclick="submitDispatchAlongWithVehicleDetails()">Submit</button>
				</div>
			</div>
		</div>
	</div>

	<div id="vehicleManageContainer" class="container mt-4"
		style="display: none;">
		<h2>Vehicle Manage Form</h2>
		<form id="vehicleForm" class="row g-3 bg-white p-4 rounded shadow">
			<!-- Row 1: Truck Number (Unique), Vehicle Name, Capacity, Owner Name -->
			<div class="row">
				<div class="col-md-3">
					<label for="truckNumber" class="form-label">Truck Number *</label>
					<input type="text" class="form-control" id="vehicleTruckNumber"
						required>
				</div>
				<div class="col-md-3">
					<label for="vehicleName" class="form-label">Vehicle Name *</label>
					<input type="text" class="form-control" id="vehicleVehicleName"
						required>
				</div>
				<div class="col-md-3">
					<label for="capacity" class="form-label">Capacity (tons) *</label>
					<input type="number" class="form-control" id="capacity" required>
				</div>
				<div class="col-md-3">
					<label for="ownerName" class="form-label">Vehicle Owner
						Name *</label> <input type="text" class="form-control" id="ownerName"
						required>
				</div>
			</div>

			<!-- Row 2: Vehicle Type, Branch, RC Number, Active Status -->
			<div class="row mt-2">
				<div class="col-md-3">
					<label for="vehicleType" class="form-label">Vehicle Type</label> <select
						id="vehicleType" class="form-select">
						<option value="">-- Select --</option>
						<option value="Open">Open</option>
						<option value="Closed">Closed</option>
						<!-- <option value="Tanker">Tanker</option> -->
					</select>
				</div>
				<!-- <div class="col-md-3">
        <label for="branch" class="form-label">Associated Branch *</label>
        <input type="text" class="form-control" id="branch" required>
      </div> -->
				<div class="col-md-3">
					<label for="rcNumber" class="form-label">RC Number</label> <input
						type="text" class="form-control" id="rcNumber">
				</div>
				<div class="col-md-3">
					<label for="isActive" class="form-label">Active</label> <select
						id="isActive" class="form-select">
						<option value="true">Yes</option>
						<option value="false">No</option>
					</select>
				</div>
			</div>

			<!-- Action Buttons -->
			<div class="btn-group mt-3 gap-2">
				<button type="submit" class="btn btn-primary">Save</button>
				<button type="reset" class="btn btn-warning text-white">Reset</button>
			</div>
		</form>
	</div>
	
	<!-- STATEMENTS FORM -->
<div id="statementsFormContainer" class="report-form"
     style="display: none; padding-bottom: 100px; overflow-y: auto; max-height: calc(100vh - 120px); border: 1px solid #ccc;">

  <h3>Statements</h3>

  <div class="row g-3 align-items-center">
    <div class="col-md-3">
      <label for="sFromDate" class="form-label">From Date</label>
      <input type="date" id="sFromDate" class="form-control">
    </div>
    <div class="col-md-3">
      <label for="sToDate" class="form-label">To Date</label>
      <input type="date" id="sToDate" class="form-control">
    </div>
    <div class="col-md-3">
      <label for="sPaymentMode" class="form-label">Payment Mode</label>
      <select id="sPaymentMode" class="form-select">
        <option value="">ALL</option>
        <option value="PAID">PAID</option>
        <option value="TO PAY">TO PAY</option>
        <option value="TBB">TBB</option>
      </select>
    </div>
    <div class="col-md-3 d-flex align-items-end gap-2">
      <button type="button" class="btn btn-primary" onclick="generateStatements()">Search</button>
      <button type="button" class="btn btn-secondary" onclick="resetStatements()">Reset</button>
    </div>
  </div>

  <div id="statementsTableContainer" class="mt-3" style="overflow-x:auto;"></div>

  <div id="statementsActions" class="mt-3" style="display:none;">
    <button class="btn btn-sm btn-success" onclick="downloadStatementsExcel()">Download Excel</button>
    <button class="btn btn-sm btn-danger" onclick="downloadStatementsPDF()">Download PDF</button>
    <button class="btn btn-sm btn-primary" onclick="printStatements()">Print</button>
  </div>

  <div id="statementsSummaryContainer" class="mt-4"></div>
</div>

	<!-- Custom Alert Box -->
	<div id="customAlert" class="modal fade" tabindex="-1"
		aria-hidden="true">
		<div class="modal-dialog modal-sm modal-dialog-centered">
			<!-- small size -->
			<div class="modal-content text-center p-3">
				<div class="modal-body">
					<p id="customAlertMessage" class="mb-3"></p>
					<button type="button" class="btn btn-primary btn-sm btn-ok">OK</button>
				</div>
			</div>
		</div>
	</div>

<!-- ========== Helper script patch (keeps search and shortcuts working) ========== -->
<script>
  (function initPatch(){
    try { $('.select2').select2({ width: '100%' }); } catch(e){}
    // recalc on load if elements exist
    recalcCharges(); updateShortcutVisual();
  })();

  // Sidebar global search handler
  function sidebarGlobalSearchHandler(){
    const q = document.getElementById('sidebarGlobalSearch').value.trim();
    if(!q){ alert('Enter LR / Consignee / Invoice'); return; }
    // Replace with your actual search code
    alert('Sidebar Global Search: ' + q);
  }

  // LR top search handler
  function lrSearchHandler(){
    const q = document.getElementById('lrTopSearch').value.trim();
    if(!q){ alert('Enter LR No to search'); return; }
    // Replace with your LR lookup logic
    alert('LR search: ' + q);
  }

  function recalcCharges(){
    const qty = Number(document.getElementById('artQuantity')?.value || 0);
    const amt = Number(document.getElementById('artAmount')?.value || 0);
    const artTotal = qty * amt;
    if(document.getElementById('freight')) document.getElementById('freight').value = artTotal.toFixed(2);
    const loading = Number(document.getElementById('loadingCharge')?.value || 0);
    const lr = Number(document.getElementById('lrCharge')?.value || 0);
    const base = artTotal + loading + lr;
    const sgst = base * 0.025, cgst = base * 0.025, igst = base * 0.05;
    if(document.getElementById('sgst')) document.getElementById('sgst').textContent = sgst.toFixed(2);
    if(document.getElementById('cgst')) document.getElementById('cgst').textContent = cgst.toFixed(2);
    if(document.getElementById('igst')) document.getElementById('igst').textContent = igst.toFixed(2);
    if(document.getElementById('grandTotal')) document.getElementById('grandTotal').textContent = '₹ ' + (base + sgst + cgst).toFixed(2);
  }

  ['artQuantity','artAmount','loadingCharge','lrCharge'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener('input', recalcCharges);
  });

  // shortcuts F7/F8/F9
  let currentMode = 'TO PAY';
  function setPaymentMode(mode){
    currentMode = mode;
    if(document.getElementById('selectedModeLabel')) document.getElementById('selectedModeLabel').textContent = mode;
    updateShortcutVisual();
  }
  function updateShortcutVisual(){
    ['kbdF7','kbdF8','kbdF9'].forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      const active = (id==='kbdF7' && currentMode==='PAID') || (id==='kbdF8' && currentMode==='TO PAY') || (id==='kbdF9' && currentMode==='TBB');
      el.style.background = active ? 'linear-gradient(90deg,var(--primary),var(--accent))' : '#e7f0ff';
      el.style.color = active ? '#fff' : '#0b5ed7';
    });
  }
  document.addEventListener('keydown', function(e){
    if(e.key === 'F7'){ e.preventDefault(); setPaymentMode('PAID'); }
    else if(e.key === 'F8'){ e.preventDefault(); setPaymentMode('TO PAY'); }
    else if(e.key === 'F9'){ e.preventDefault(); setPaymentMode('TBB'); }
  }, true);
</script>

<script2
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

	<script src="/js/bookings.js"></script>

</body>
</html>
